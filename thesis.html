<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Thesis.web - Academic Suite</title>
    
    <!-- PWA Meta -->
    <meta name="theme-color" content="#FFDE59">
    <meta name="description" content="ABNT, APA, and MLA Academic Editor">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* =========================================
           NEO-BRUTALIST THEME
           ========================================= */
        :root {
            --c-bg: #e0e0e0;
            --c-panel: #ffffff;
            --c-border: #000000;
            --c-text: #000000;
            
            --c-primary: #FFDE59;   /* Acid Yellow */
            --c-secondary: #FF90E8; /* Hot Pink */
            --c-accent: #23C9FF;    /* Cyan */
            --c-success: #00E096;   /* Green */
            
            --border-width: 3px;
            --shadow-hard: 4px 4px 0px var(--c-border);
            --font-ui: 'Courier New', Courier, monospace;
        }

        [data-theme="dark"] {
            --c-bg: #121212;
            --c-panel: #1e1e1e;
            --c-text: #ffffff;
            --c-border: #ffffff;
            --c-primary: #bfa300;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--c-bg);
            color: var(--c-text);
            font-family: var(--font-ui);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* =========================================
           UI COMPONENTS
           ========================================= */
        .btn {
            background: var(--c-panel);
            border: var(--border-width) solid var(--c-border);
            box-shadow: 2px 2px 0px var(--c-border);
            padding: 8px 12px;
            font-family: var(--font-ui);
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.1s;
            display: inline-flex; align-items: center; gap: 6px;
        }
        .btn:hover { transform: translate(-1px, -1px); box-shadow: 3px 3px 0px var(--c-border); }
        .btn:active, .btn.active { transform: translate(2px, 2px); box-shadow: 0px 0px 0px var(--c-border); }
        
        .btn-primary { background: var(--c-primary); }
        .btn-secondary { background: var(--c-secondary); }
        .btn-sm { padding: 4px 8px; font-size: 11px; }
        .btn-icon { width: 36px; height: 36px; padding: 0; justify-content: center; }

        .panel {
            background: var(--c-panel);
            border: var(--border-width) solid var(--c-border);
            z-index: 10;
        }

        /* =========================================
           LAYOUT
           ========================================= */
        header {
            height: 50px;
            border-bottom: var(--border-width) solid var(--c-border);
            background: var(--c-primary);
            display: flex; align-items: center; justify-content: space-between; padding: 0 15px;
            z-index: 20;
        }
        .logo { font-size: 20px; font-weight: 900; letter-spacing: -1px; }

        #app-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* SIDEBAR */
        #sidebar {
            width: 300px;
            border-right: var(--border-width) solid var(--c-border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-section { padding: 15px; border-bottom: 2px solid var(--c-border); }
        .sidebar-title { font-weight: 900; margin-bottom: 10px; display: block; font-size: 14px; text-transform: uppercase;}

        .format-option {
            display: block; width: 100%; text-align: left;
            margin-bottom: 5px; padding: 8px;
            border: 2px solid var(--c-border);
            cursor: pointer;
            background: #fff;
            font-weight: bold;
        }
        .format-option:hover { background: var(--c-primary); }
        .format-option.active { background: var(--c-accent); color: #fff; border-color: #000; box-shadow: 2px 2px 0 #000; }

        /* WORKSPACE */
        #workspace {
            flex: 1;
            background-color: #999;
            /* Graph paper pattern */
            background-image: linear-gradient(var(--c-border) 1px, transparent 1px), linear-gradient(90deg, var(--c-border) 1px, transparent 1px);
            background-size: 20px 20px;
            background-color: #e0e0e0;
            overflow: auto;
            padding: 40px;
            display: flex; justify-content: center;
        }

        /* THE PAPER SHEET */
        #paper {
            width: 210mm; /* A4 Width */
            min-height: 297mm; /* A4 Height */
            background: white;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.5);
            padding: 40px; /* Default Screen Padding */
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* COVER PAGE */
        #cover-page {
            height: 297mm;
            display: none; /* Hidden by default */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            page-break-after: always;
        }

        /* EDITOR AREA */
        #editor-area {
            flex: 1;
            outline: none;
            white-space: pre-wrap;
        }

        /* Formatting Toolbar (Sticky in sidebar or separate) */
        .toolbar-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 5px;
        }

        /* STATUS FOOTER */
        footer {
            height: 30px; background: var(--c-panel); border-top: var(--border-width) solid var(--c-border);
            display: flex; align-items: center; justify-content: space-between; padding: 0 15px; font-size: 11px;
            font-weight: bold;
        }

        /* =========================================
           ACADEMIC STYLES (Applied to #paper)
           ========================================= */
        
        /* ABNT (Brazil) */
        .style-abnt {
            font-family: Arial, sans-serif;
            color: black;
        }
        .style-abnt #editor-area, .style-abnt p, .style-abnt li {
            font-size: 12pt;
            line-height: 1.5;
            text-align: justify;
            margin-bottom: 0; /* ABNT has no standard para spacing, but line height handles it */
            text-indent: 1.25cm;
        }
        .style-abnt h1 { font-size: 14pt; font-weight: bold; text-align: left; margin-bottom: 0; text-indent: 0; }
        .style-abnt h2 { font-size: 12pt; font-weight: bold; text-align: left; margin-bottom: 0; text-indent: 0; }
        
        /* APA (US/Canada) */
        .style-apa {
            font-family: 'Times New Roman', serif;
        }
        .style-apa #editor-area, .style-apa p, .style-apa li {
            font-size: 12pt;
            line-height: 2; /* Double spacing */
            text-align: left;
            margin-bottom: 10px;
            text-indent: 0.5in;
        }
        .style-apa p:first-of-type { text-indent: 0; }
        .style-apa h1 { font-size: 12pt; font-weight: bold; text-align: center; margin-bottom: 10px; }

        /* MLA (Europe/US) */
        .style-mla {
            font-family: 'Times New Roman', serif;
        }
        .style-mla #editor-area, .style-mla p {
            font-size: 12pt;
            line-height: 1;
            text-align: left;
            margin-bottom: 10px;
        }
        
        /* Citation Helper Modal */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex; align-items: center; justify-content: center;
            z-index: 1000;
        }
        .modal.hidden { display: none; }
        .modal-content {
            background: var(--c-panel); border: var(--border-width) solid var(--c-border);
            width: 90%; max-width: 500px;
            padding: 20px;
            box-shadow: 8px 8px 0px var(--c-border);
        }
        .modal-header { font-size: 20px; font-weight: 900; margin-bottom: 15px; border-bottom: 3px solid #000; padding-bottom: 10px;}
        
        .form-group { margin-bottom: 10px; }
        .form-group label { display: block; font-weight: bold; font-size: 12px; margin-bottom: 4px; }
        .form-group input, .form-group select {
            width: 100%; padding: 8px; border: 2px solid #000; font-family: var(--font-ui);
        }

        /* Toast */
        .toast {
            position: fixed; bottom: 40px; right: 20px;
            background: var(--c-success); color: #000;
            padding: 10px 20px; border: 2px solid #000;
            box-shadow: 4px 4px 0px #000;
            font-weight: bold; z-index: 2000;
        }

        /* =========================================
           PRINT / PDF ENGINE
           ========================================= */
        @media print {
            body { background: white; height: auto; overflow: visible; display: block; }
            header, #sidebar, footer, .modal, .toast, .toolbar-grid { display: none !important; }
            #workspace { padding: 0; background: white; display: block; overflow: visible; }
            #paper {
                box-shadow: none; margin: 0; width: 100%; padding: 0; min-height: auto;
                page-break-after: auto;
            }
            
            /* Print Specific Margins */
            /* ABNT: Superior 3cm, Esquerda 3cm, Inferior 2cm, Direita 2cm */
            .style-abnt #paper { padding: 3cm 2cm 2cm 3cm !important; }
            
            /* APA: 1 inch all around */
            .style-apa #paper { padding: 1in !important; }

            /* MLA: 1 inch all around */
            .style-mla #paper { padding: 1in !important; }
        }

        @media (max-width: 768px) {
            #sidebar { display: none; position: absolute; height: 100%; width: 85%; }
            #sidebar.active { display: flex; }
            #paper { width: 100%; padding: 15px; }
            #toolbar-mobile { display: block !important; }
        }
    </style>
</head>
<body>

    <!-- HEADER -->
    <header>
        <div class="logo"><i class="fas fa-graduation-cap"></i> THESIS.WEB</div>
        <div style="display:flex; gap:5px;">
            <button class="btn btn-sm" id="btn-cite"><i class="fas fa-quote-right"></i> Cite</button>
            <button class="btn btn-sm btn-primary" id="btn-save"><i class="fas fa-save"></i> Save</button>
            <button class="btn btn-sm" id="btn-print"><i class="fas fa-print"></i> PDF</button>
        </div>
    </header>

    <div id="app-container">
        
        <!-- SIDEBAR -->
        <aside class="panel" id="sidebar">
            <!-- Standard Selection -->
            <div class="sidebar-section">
                <span class="sidebar-title">1. Standard</span>
                <button class="format-option active" data-style="style-abnt" onclick="App.setStandard('abnt')">
                    <i class="fas fa-flag"></i> ABNT (Brazil)
                    <div style="font-size:10px; font-weight:normal;">Arial 12pt, Justify, 1.5 space</div>
                </button>
                <button class="format-option" data-style="style-apa" onclick="App.setStandard('apa')">
                    <i class="fas fa-landmark"></i> APA (US/Can)
                    <div style="font-size:10px; font-weight:normal;">Times New Roman, Double space</div>
                </button>
                <button class="format-option" data-style="style-mla" onclick="App.setStandard('mla')">
                    <i class="fas fa-university"></i> MLA (Humanities)
                    <div style="font-size:10px; font-weight:normal;">Times New Roman, Header style</div>
                </button>
            </div>

            <!-- Formatting Tools -->
            <div class="sidebar-section">
                <span class="sidebar-title">2. Formatting</span>
                <div class="toolbar-grid">
                    <button class="btn btn-sm" onclick="document.execCommand('bold')"><b>B</b></button>
                    <button class="btn btn-sm" onclick="document.execCommand('italic')"><i>I</i></button>
                    <button class="btn btn-sm" onclick="document.execCommand('underline')"><u>U</u></button>
                    <button class="btn btn-sm" onclick="document.execCommand('strikeThrough')"><s>S</s></button>
                </div>
                <div style="height:5px;"></div>
                <div class="toolbar-grid">
                    <button class="btn btn-sm" onclick="document.execCommand('justifyLeft')"><i class="fas fa-align-left"></i></button>
                    <button class="btn btn-sm" onclick="document.execCommand('justifyCenter')"><i class="fas fa-align-center"></i></button>
                    <button class="btn btn-sm" onclick="document.execCommand('justifyRight')"><i class="fas fa-align-right"></i></button>
                    <button class="btn btn-sm" onclick="document.execCommand('insertUnorderedList')"><i class="fas fa-list-ul"></i></button>
                </div>
                <div style="margin-top:10px;">
                    <button class="btn btn-sm" style="width:100%" onclick="document.execCommand('formatBlock', false, 'h1')">Heading 1 (Title)</button>
                    <button class="btn btn-sm" style="width:100%; margin-top:5px;" onclick="document.execCommand('formatBlock', false, 'h2')">Heading 2 (Subtitle)</button>
                    <button class="btn btn-sm" style="width:100%; margin-top:5px;" onclick="document.execCommand('formatBlock', false, 'p')">Normal Paragraph</button>
                </div>
            </div>

            <!-- Cover Page Generator -->
            <div class="sidebar-section">
                <span class="sidebar-title">3. Cover Page</span>
                <button class="btn btn-sm btn-secondary" style="width:100%" id="btn-insert-cover"><i class="fas fa-file"></i> Insert ABNT Cover</button>
                <small style="display:block; margin-top:5px; color:#666;">Inserts a formatted cover page at the start.</small>
            </div>
        </aside>

        <!-- MAIN WORKSPACE -->
        <main id="workspace">
            <div id="paper" class="style-abnt">
                <!-- Cover Page (Hidden initially) -->
                <div id="cover-page">
                    <h1>INSTITUTION NAME</h1>
                    <h2>Author Name</h2>
                    <h3>Title of the Work</h3>
                    <p style="margin-top:100px;">City</p>
                    <p>Year</p>
                </div>

                <!-- Main Text Editor -->
                <div id="editor-area" contenteditable="true">
                    <h1>Start writing your academic work here...</h1>
                    <p>The text will automatically adjust to the <b>ABNT</b> standards (or APA/MLA depending on selection).</p>
                    <p>Tip: Use the sidebar to change standards. The margins and fonts are set for <b>Print / PDF export</b>.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- FOOTER -->
    <footer>
        <div id="status-std">STD: ABNT (NBR 14724)</div>
        <div id="status-words">Words: 0 | Chars: 0</div>
        <div id="status-save"><i class="fas fa-check-circle" style="color:var(--c-success)"></i> Saved</div>
    </footer>

    <!-- CITATION MODAL -->
    <div class="modal hidden" id="cite-modal">
        <div class="modal-content">
            <div class="modal-header">Citation Generator</div>
            <div class="form-group">
                <label>Standard</label>
                <select id="cite-std">
                    <option value="abnt">ABNT</option>
                    <option value="apa">APA</option>
                </select>
            </div>
            <div class="form-group">
                <label>Author (Surname, Name)</label>
                <input type="text" id="cite-author" placeholder="Silva, Joao">
            </div>
            <div class="form-group">
                <label>Title</label>
                <input type="text" id="cite-title" placeholder="Book Title">
            </div>
            <div class="form-group">
                <label>Subtitle (Optional)</label>
                <input type="text" id="cite-subtitle" placeholder="Subtitle">
            </div>
            <div class="form-group">
                <label>City of Publisher</label>
                <input type="text" id="cite-city" placeholder="Sao Paulo">
            </div>
            <div class="form-group">
                <label>Publisher</label>
                <input type="text" id="cite-pub" placeholder="Editora XYZ">
            </div>
            <div class="form-group">
                <label>Year</label>
                <input type="number" id="cite-year" placeholder="2023">
            </div>
            <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:15px;">
                <button class="btn" onclick="document.getElementById('cite-modal').classList.add('hidden')">Cancel</button>
                <button class="btn btn-primary" id="btn-generate-cite">Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <!-- TOAST -->
    <div class="toast hidden" id="toast-msg">Citation Copied!</div>

    <script>
        class ThesisApp {
            constructor() {
                this.paper = document.getElementById('paper');
                this.editor = document.getElementById('editor-area');
                this.currentStandard = 'abnt';
                
                this.init();
            }

            init() {
                // Load saved content
                const saved = localStorage.getItem('thesis-content');
                if (saved) {
                    this.editor.innerHTML = saved;
                }
                
                // Load saved standard
                const savedStd = localStorage.getItem('thesis-std');
                if (savedStd) {
                    this.setStandard(savedStd);
                }

                // Listeners
                this.editor.addEventListener('input', () => {
                    this.updateStats();
                    this.autoSave();
                });

                document.getElementById('btn-save').onclick = () => this.downloadHTML();
                document.getElementById('btn-print').onclick = () => window.print();
                
                document.getElementById('btn-cite').onclick = () => document.getElementById('cite-modal').classList.remove('hidden');
                document.getElementById('btn-insert-cover').onclick = () => this.insertCover();
                
                document.getElementById('btn-generate-cite').onclick = () => this.generateCitation();

                this.updateStats();
            }

            setStandard(std) {
                this.currentStandard = std;
                
                // Update UI buttons
                document.querySelectorAll('.format-option').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`.format-option[data-style="style-${std}"]`).classList.add('active');

                // Update Paper CSS
                this.paper.className = ''; // Reset
                this.paper.classList.add(`style-${std}`);

                // Update Footer
                const names = { abnt: 'ABNT (NBR 14724)', apa: 'APA (7th Ed)', mla: 'MLA (9th Ed)' };
                document.getElementById('status-std').innerText = `STD: ${names[std]}`;

                localStorage.setItem('thesis-std', std);
                this.toast(`Switched to ${std.toUpperCase()}`);
            }

            insertCover() {
                // Logic to create ABNT cover structure
                // In a real app, we might prompt for fields, but for now we insert a template
                const coverHTML = `
<div contenteditable="false" style="text-align:center; margin-bottom: 50px;">
    <h2 contenteditable="true">INSTITUTION NAME</h2>
    <p contenteditable="true">Author Name</p>
    <h1 contenteditable="true">Title of the Thesis</h1>
    <p contenteditable="true">Subtitle</p>
    <br><br><br>
    <p contenteditable="true">City</p>
    <p contenteditable="true">Year</p>
</div>
<hr style="border:0; border-bottom: 1px solid #000; margin: 30px 0;">
                `;
                
                // Check if cover exists
                if(!document.getElementById('user-cover')) {
                    const div = document.createElement('div');
                    div.id = 'user-cover';
                    div.innerHTML = coverHTML;
                    this.paper.insertBefore(div, this.editor);
                } else {
                    this.toast('Cover already exists');
                }
            }

            generateCitation() {
                const std = document.getElementById('cite-std').value;
                const auth = document.getElementById('cite-author').value;
                const title = document.getElementById('cite-title').value;
                const sub = document.getElementById('cite-subtitle').value;
                const city = document.getElementById('cite-city').value;
                const pub = document.getElementById('cite-pub').value;
                const year = document.getElementById('cite-year').value;

                let result = '';

                if (std === 'abnt') {
                    // SURNAME, Name. Title: subtitle. City: Publisher, Year.
                    result = `${auth}. <b>${title}</b>${sub ? ': ' + sub : ''}. ${city}: ${pub}, ${year}.`;
                } else if (std === 'apa') {
                    // Surname, N. (Year). Title. City: Publisher.
                    const parts = auth.split(',');
                    const surname = parts[0];
                    const initial = parts[1] || '';
                    result = `${surname}, ${initial}. (${year}). <i>${title}</i>. ${city}: ${pub}.`;
                }

                // Copy to clipboard
                navigator.clipboard.writeText(result).then(() => {
                    this.toast('Citation Copied!');
                    document.getElementById('cite-modal').classList.add('hidden');
                });
            }

            updateStats() {
                const text = this.editor.innerText || '';
                const words = text.trim().split(/\s+/).length;
                const chars = text.length;
                document.getElementById('status-words').innerText = `Words: ${words} | Chars: ${chars}`;
            }

            autoSave() {
                const content = this.editor.innerHTML;
                localStorage.setItem('thesis-content', content);
                const status = document.getElementById('status-save');
                status.innerHTML = '<i class="fas fa-pen"></i> Saving...';
                setTimeout(() => {
                    status.innerHTML = '<i class="fas fa-check-circle" style="color:var(--c-success)"></i> Saved';
                }, 500);
            }

            downloadHTML() {
                const htmlContent = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>My Document</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 3cm 2cm 2cm 3cm; }
        h1 { font-size: 14pt; font-weight: bold; }
        p { font-size: 12pt; line-height: 1.5; text-align: justify; text-indent: 1.25cm; }
    </style>
</head>
<body>
    ${this.paper.innerHTML}
</body>
</html>
                `;
                const blob = new Blob([htmlContent], {type: 'text/html'});
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'thesis_document.html';
                a.click();
                this.toast('Downloaded HTML');
            }

            toast(msg) {
                const t = document.getElementById('toast-msg');
                t.innerText = msg;
                t.classList.remove('hidden');
                setTimeout(() => t.classList.add('hidden'), 2000);
            }
        }

        const App = new ThesisApp();
    </script>
</body>
</html>
